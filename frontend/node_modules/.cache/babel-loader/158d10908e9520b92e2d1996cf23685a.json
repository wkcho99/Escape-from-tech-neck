{"ast":null,"code":"import _regeneratorRuntime from\"/home/bastian_preisel/gitProjects/Escape-from-tech-neck/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/bastian_preisel/gitProjects/Escape-from-tech-neck/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/bastian_preisel/gitProjects/Escape-from-tech-neck/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useRef}from\"react\";import Webcam from\"react-webcam\";import\"./camera.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var WebcamComponent=function WebcamComponent(){return/*#__PURE__*/_jsx(Webcam,{});};var videoConstraints={width:650,height:520,facingMode:\"user\"};var playAlert;var toggle=\"stop\";var TestOverlay=function TestOverlay(){var _useState=useState(\"start tracking\"),_useState2=_slicedToArray(_useState,2),buttonName=_useState2[0],setButtonName=_useState2[1];var webcamRef=React.useRef(null);var _React$useState=React.useState(null),_React$useState2=_slicedToArray(_React$useState,2),imgSrc=_React$useState2[0],setImgSrc=_React$useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),result=_useState4[0],setResult=_useState4[1];var canvasRef=useRef();var imageRef=useRef();var videoRef=useRef();// Get camera feed\nuseEffect(function(){function getCameraStream(){return _getCameraStream.apply(this,arguments);}function _getCameraStream(){_getCameraStream=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var stream;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return navigator.mediaDevices.getUserMedia({audio:false,video:true});case 2:stream=_context.sent;if(videoRef.current){videoRef.current.srcObject=stream;}case 4:case\"end\":return _context.stop();}}},_callee);}));return _getCameraStream.apply(this,arguments);};getCameraStream();},[]);// Send iage to API\nuseEffect(function(){var interval=setInterval(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var formData,response,text;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:captureImageFromCamera();if(!imageRef.current){_context2.next=15;break;}formData=new FormData();formData.append('image',imageRef.current);_context2.next=6;return fetch('/classify',{method:\"POST\",body:formData});case 6:response=_context2.sent;if(!(response.status===200)){_context2.next=14;break;}_context2.next=10;return response.text();case 10:text=_context2.sent;setResult(text);_context2.next=15;break;case 14:setResult(\"Error from API. \");case 15:case\"end\":return _context2.stop();}}},_callee2);})),1000);return function(){return clearInterval(interval);};},[]);var playCameraStream=function playCameraStream(){if(videoRef.current){videoRef.current.play();}};var captureImageFromCamera=function captureImageFromCamera(){var context=canvasRef.current.getContext('2d');var _videoRef$current=videoRef.current,videoWidth=_videoRef$current.videoWidth,videoHeight=_videoRef$current.videoHeight;canvasRef.current.width=videoWidth;canvasRef.current.height=videoHeight;context.drawImage(videoRef.current,0,0,videoWidth,videoHeight);canvasRef.current.toBlob(function(blob){imageRef.current=blob;});};var capture=React.useCallback(function(){var imageSrc=webcamRef.current.getScreenshot();setImgSrc(imageSrc);},[webcamRef,setImgSrc]);console.log(\"play\",playAlert);var func1=function func1(){capture();};var toggleAlert=function toggleAlert(){if(toggle==\"stop\"){startAlert();toggle=\"start\";setButtonName(\"stop tracking\");}else if(toggle==\"start\"){stopAlert();toggle=\"stop\";setButtonName(\"start tracking\");}};var startAlert=function startAlert(){playAlert=setInterval(func1,10000);console.log(\"start\",playAlert);};var stopAlert=function stopAlert(){console.log(\"stop\",playAlert);clearInterval(playAlert);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Webcam,{audio:false,ref:webcamRef,videoConstraints:videoConstraints,screenshotFormat:\"image/jpeg\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"startTrack\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"startBut\",onClick:toggleAlert,children:buttonName}),/*#__PURE__*/_jsxs(\"main\",{children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,onCanPlay:function onCanPlay(){return playCameraStream();},id:\"video\"}),/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,hidden:true}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Currently seeing: \",result]})]})]}),imgSrc&&/*#__PURE__*/_jsx(\"img\",{src:imgSrc})]});};export default TestOverlay;","map":{"version":3,"sources":["/home/bastian_preisel/gitProjects/Escape-from-tech-neck/frontend/src/components/camera/camera.js"],"names":["React","useState","useEffect","useRef","Webcam","WebcamComponent","videoConstraints","width","height","facingMode","playAlert","toggle","TestOverlay","buttonName","setButtonName","webcamRef","imgSrc","setImgSrc","result","setResult","canvasRef","imageRef","videoRef","getCameraStream","navigator","mediaDevices","getUserMedia","audio","video","stream","current","srcObject","interval","setInterval","captureImageFromCamera","formData","FormData","append","fetch","method","body","response","status","text","clearInterval","playCameraStream","play","context","getContext","videoWidth","videoHeight","drawImage","toBlob","blob","capture","useCallback","imageSrc","getScreenshot","console","log","func1","toggleAlert","startAlert","stopAlert"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport Webcam from \"react-webcam\";\r\nimport \"./camera.css\"\r\nconst WebcamComponent = () => <Webcam />;\r\nconst videoConstraints = {\r\n    width: 650,\r\n    height: 520,\r\n    facingMode: \"user\"\r\n  };\r\n  let playAlert;\r\n  let toggle = \"stop\";\r\n\r\n  const TestOverlay = () => {\r\n    const [buttonName,setButtonName] = useState(\"start tracking\");\r\n    const webcamRef = React.useRef(null);\r\n    const [imgSrc, setImgSrc] = React.useState(null);\r\n\r\n    const [result, setResult] = useState(\"\");\r\n    const canvasRef = useRef();\r\n    const imageRef = useRef();\r\n    const videoRef = useRef();\r\n    \r\n    // Get camera feed\r\n    useEffect(() => {\r\n      async function getCameraStream() {\r\n        const stream = await navigator.mediaDevices.getUserMedia({\r\n          audio: false,\r\n          video: true,\r\n        });\r\n    \r\n        if (videoRef.current) {      \r\n          videoRef.current.srcObject = stream;\r\n        }\r\n      };\r\n    \r\n      getCameraStream();\r\n    }, []);\r\n\r\n    // Send iage to API\r\n    useEffect(() => {\r\n      const interval = setInterval(async () => {\r\n        captureImageFromCamera();\r\n\r\n        if (imageRef.current) {\r\n          const formData = new FormData();\r\n          formData.append('image', imageRef.current);\r\n\r\n          const response = await fetch('/classify', {\r\n            method: \"POST\",\r\n            body: formData,\r\n          });\r\n\r\n          // setResult(response.status)\r\n\r\n          if (response.status === 200) {\r\n            const text = await response.text();\r\n            setResult(text);\r\n          } else {\r\n            setResult(\"Error from API. \");\r\n          }\r\n        }\r\n      }, 1000);\r\n      return () => clearInterval(interval);\r\n    }, []);\r\n\r\n    const playCameraStream = () => {\r\n      if (videoRef.current) {\r\n        videoRef.current.play();\r\n      }\r\n    };\r\n\r\n    const captureImageFromCamera = () => {\r\n      const context = canvasRef.current.getContext('2d');\r\n      const { videoWidth, videoHeight } = videoRef.current;\r\n  \r\n      canvasRef.current.width = videoWidth;\r\n      canvasRef.current.height = videoHeight;\r\n  \r\n      context.drawImage(videoRef.current, 0, 0, videoWidth, videoHeight);\r\n  \r\n      canvasRef.current.toBlob((blob) => {\r\n        imageRef.current = blob;\r\n      })\r\n    };\r\n\r\n    const capture = React.useCallback(() => {\r\n      const imageSrc = webcamRef.current.getScreenshot();\r\n      setImgSrc(imageSrc);\r\n    }, [webcamRef, setImgSrc]);\r\n    console.log(\"play\",playAlert);\r\n    const func1 = () =>{\r\n        capture();\r\n    }\r\n\r\n    const toggleAlert=function(){\r\n      if(toggle==\"stop\") {\r\n        startAlert();\r\n        toggle = \"start\";\r\n        setButtonName(\"stop tracking\");\r\n      }\r\n      else if(toggle==\"start\") {\r\n        stopAlert();\r\n        toggle = \"stop\";\r\n        setButtonName(\"start tracking\");\r\n      }\r\n    }\r\n\r\n    const startAlert = function() {\r\n        playAlert = setInterval(func1, 10000);\r\n        console.log(\"start\",playAlert);\r\n      };\r\n\r\n    const stopAlert = function() {\r\n        console.log(\"stop\",playAlert);\r\n        clearInterval(playAlert);\r\n      };\r\n  \r\n    return (\r\n      <>\r\n        <Webcam\r\n          audio={false}\r\n          ref={webcamRef}\r\n          videoConstraints = {videoConstraints}\r\n          screenshotFormat=\"image/jpeg\"\r\n        />\r\n        <div className =\"startTrack\">\r\n        <button className=\"startBut\" onClick={toggleAlert}>\r\n            {buttonName}\r\n        </button>\r\n        <main>\r\n        <video ref={videoRef} onCanPlay={() => playCameraStream()} id=\"video\" />\r\n        <canvas ref={canvasRef} hidden></canvas>\r\n        <p>Currently seeing: {result}</p>\r\n      </main>\r\n        </div>\r\n        {imgSrc && (\r\n          <img\r\n            src={imgSrc}\r\n          />\r\n        )}\r\n      </>\r\n    );\r\n  };\r\n\r\n  export default TestOverlay"]},"metadata":{},"sourceType":"module"}